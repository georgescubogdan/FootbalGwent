// Please see documentation at https://docs.microsoft.com/aspnet/core/client-side/bundling-and-minification
// for details on configuring this project to bundle and minify static web assets.

// Write your JavaScript code.
let receivedPlayers = [
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    },
    {
        image: "https://placehold.it/200x200",
        name: "Player Name",
        country: "Wonderland",
        fc: "FC Best",
        attack: 6,
        defense: 4
    }
]
let receivedFunctionalities = [
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Functionality name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil perspiciatis ipsum quos non delectus iure vitae cumque inventore autem assumenda, aperiam magnam architecto suscipit blanditiis facere modi aut id ea."
    }
]
let receivedLeaders = [
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    },
    {
        image: "https://placehold.it/200x200",
        name: "Leader Name",
        description: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi."
    }
]

const game = {
    playersToSelect: 11,
    functionalitiesToSelect: 5,
    leadersToSelect: 1,
    nextLevel: 0,
    cardToPut: null,
    init() {
        this.modal = document.querySelector(".modal");
        this.startBtn = document.querySelector("#startButton");
        this.modalTitle = document.querySelector(".modal-title");
        this.infoBox = document.querySelector(".info-box");
        this.clickedCard = document.querySelector(".me .clicked-card");
        this.startBtn.onclick = () => this.start();
        this.nextBtn = document.querySelector("#nextButton");
        this.nextBtn.onclick = () => this.next();
        this.modalContent = document.querySelector(".select-items");
        this.generatePlayers(receivedPlayers);
        const generatedPlayers = document.querySelectorAll(".select-items .player");
        this.asignClicks(generatedPlayers, "selected-player", "players");
        this.myAttackLine = document.querySelector(".field .me .attack-line");
        this.myMiddleLine = document.querySelector(".field .me .middle-line");
        this.myDefenseLine = document.querySelector(".field .me .defense-line");
        this.myGoalkeeperLine = document.querySelector(".field .me .goalkeeper-line");

        this.myAttackLineScore = document.querySelector(".field .me .attack-line .line-score");
        this.myMiddleLineScore = document.querySelector(".field .me .middle-line .line-score");
        this.myDefenseLineScore = document.querySelector(".field .me .defense-line .line-score");
        this.myGoalkeeperLineScore = document.querySelector(".field .me .goalkeeper-line .line-score");

        this.myAttackLine.onclick = () => this.putClickedCardOnField(this.myAttackLine);
        this.myMiddleLine.onclick = () => this.putClickedCardOnField(this.myMiddleLine);
        this.myDefenseLine.onclick = () => this.putClickedCardOnField(this.myDefenseLine);
        this.myGoalkeeperLine.onclick = () => this.putClickedCardOnField(this.myGoalkeeperLine);

        /*
            window.onclick = (e) => {
              if (e.target == this.modal) {
                this.modal.classList.remove("modal-active");
              }
            }*/

        this.enemyAttackLine = document.querySelector(".field .enemy .attack-line");
        this.enemyMiddleLine = document.querySelector(".field .enemy .middle-line");
        this.enemyDefenseLine = document.querySelector(".field .enemy .defense-line");
        this.enemyGoalkeeperLine = document.querySelector(".field .enemy .goalkeeper-line");

        this.enemyAttackLineScore = document.querySelector(".field .enemy .attack-line .line-score");
        this.enemyMiddleLineScore = document.querySelector(".field .enemy .middle-line .line-score");
        this.enemyDefenseLineScore = document.querySelector(".field .enemy .defense-line .line-score");
        this.enemyGoalkeeperLineScore = document.querySelector(".field .enemy .goalkeeper-line .line-score");

        this.passBtn = document.querySelector("#pass");
    },

    asignClicks(arr, activeItemClass, itemsName) {
        arr.forEach(item => {
            item.onclick = () => {
                if (item.classList.contains(activeItemClass)) {
                    item.classList.remove(activeItemClass);
                    this[`${itemsName}ToSelect`]++;
                    this.infoBox.innerHTML = `${itemsName} to select:<br>${this[`${itemsName}ToSelect`]}`;
                } else {
                    if (this[`${itemsName}ToSelect`] > 0) {
                        item.classList.add(activeItemClass);
                        this[`${itemsName}ToSelect`]--;
                        this.infoBox.innerHTML = `${itemsName} to select:<br>${this[`${itemsName}ToSelect`]}`;
                    } else {
                        alert(`You have already selected all ${itemsName}. Press "Next" to continue.`);
                    }
                }
            }
        })
    },

    start() {
        this.startBtn.style.display = "none";
        this.modal.classList.add("modal-active");
        this.infoBox.innerHTML = `Players to select:<br>11`;
    },

    next() {
        if (this.nextLevel === 0) {
            if (this.playersToSelect > 0) {
                alert(`Please, select ${this.playersToSelect} more players`);
            } else {
                this.selectedPlayers = document.querySelectorAll(".selected-player");
                this.nextLevel++;
                this.modalTitle.innerHTML = "Select functionalities";
                this.infoBox.innerHTML = `Functionalities to select:<br>5`;
                this.generateFunctionalities(receivedFunctionalities);
                const generatedFunctionalities = document.querySelectorAll(".select-items .functionality");
                this.asignClicks(generatedFunctionalities, "selected-functionality", "functionalities");
            }
        } else if (this.nextLevel === 1) {
            if (this.functionalitiesToSelect > 0) {
                alert(`Please, select ${this.functionalitiesToSelect} more functionalities`);
            } else {
                this.selectedFunctionalities = document.querySelectorAll(".selected-functionality");
                this.nextLevel++;
                this.nextBtn.innerHTML = "Start";
                this.modalTitle.innerHTML = "Select leader";
                this.infoBox.innerHTML = `Leader to select:<br>1`;
                this.generateLeaders(receivedLeaders);
                const generatedLeaders = document.querySelectorAll(".select-items .leader");
                this.asignClicks(generatedLeaders, "selected-leader", "leaders");
            }
        } else if (this.nextLevel === 2) {
            this.selectedLeader = document.querySelector(".selected-leader");
            this.modal.classList.remove("modal-active");
            this.nextBtn.innerHTML = "Next";
            console.log(this.selectedPlayers);
            console.log(this.selectedFunctionalities);
            console.log(this.selectedLeader);
            this.putMySelectedCards();
        }
    },

    putClickedCardOnField(line) {
        cardsPlace = line.querySelector(".cards-place");
        score = line.querySelector(".line-score");
        let newScore = 0;
        if (this.cardToPut && players.find(p => p.id === player.id).turn === true) {
            cardsPlace.appendChild(this.cardToPut);
            this.cardToPut.onclick = () => this.showClickedCard(this.cardToPut);
            this.cardToPut = null;
            this.clickedCard.innerHTML = "";

            const players = line.querySelectorAll(".player");
            players.forEach(item => {
                item.onclick = () => this.showClickedCard(item);
                att = Number(item.querySelector(".attack span").innerHTML);
                def = Number(item.querySelector(".defense span").innerHTML);
                newScore += att + def;
            });
            score.innerHTML = newScore;

            const functionalities = line.querySelectorAll(".functionality");
            functionalities.forEach(item => item.onclick = () => this.showClickedCard(item));

            if ((players.length + functionalities.length) > 8) {
                cardsPlace.style.justifyContent = "flex-start";
            }
            this.updateTurn();
        } else {
            console.log(players);
            alert("Not your turn, bro!");
        }
    },
    updateTurn() {
        //console.log("update");
        //console.log(players);
        let thisPlayer = players.find(p => p.id === player.id);
        thisPlayer.turn = !thisPlayer.turn;
        let other = players.find(p => p.id !== player.id);
        other.turn = !other.turn;
        players = [thisPlayer, other];
        console.log(player.id);
        update();
        //players.forEach(p => { p.turn = !p.turn });
        //console.log(players);
    },
    showClickedCard(item) {
        this.clickedCard.innerHTML = "";
        newItem = item.cloneNode(true);
        this.clickedCard.appendChild(newItem);
    },

    putClickedCard(item) {
        this.showClickedCard(item);
        this.cardToPut = item;
    },

    putMySelectedCards() {
        this.leaderPlace = document.querySelector(".info .me .leader-place");
        this.cardsPlace = document.querySelector(".info .me .cards-place");

        this.selectedLeader.classList.remove("selected-leader");
        this.leaderPlace.appendChild(this.selectedLeader);

        this.selectedFunctionalities.forEach(item => {
            item.onclick = () => this.putClickedCard(item);
            item.classList.remove("selected-functionality");
            this.cardsPlace.appendChild(item);
        });
        this.selectedPlayers.forEach(item => {
            item.onclick = () => this.putClickedCard(item);
            item.classList.remove("selected-player");
            this.cardsPlace.appendChild(item);
        });
    },

    generateLeaders(arr) {
        const { modalContent: leaders } = this;
        leaders.innerHTML = "";
        arr.forEach(item => {
            leaders.innerHTML += `
      <div class="card leader">
        <div class="photo">
          <img src=${item.image} alt="leader photo">
        </div>
        <div class="information">
          <div class="name">
            ${item.name}
          </div>
          <div class="description">
            ${item.description}
          </div>
        </div>
      </div>
      `
        })
    },

    generateFunctionalities(arr) {
        const { modalContent: functionalities } = this;
        functionalities.innerHTML = "";
        arr.forEach(item => {
            functionalities.innerHTML += `
      <div class="card functionality">
        <div class="photo">
          <img src=${item.image} alt="functionality photo">
        </div>
        <div class="information">
          <div class="name">
            ${item.name}
          </div>
          <div class="description">
            ${item.description}
          </div>
        </div>

      </div>
      `
        })
    },

    generatePlayers(arr) {
        //console.log(this.modalContent);
        const { modalContent: players } = this;
        players.innerHTML = "";
        arr.forEach(item => {
            players.innerHTML += `
      <div class="card player">
        <div class="photo">
          <img src=${item.image} alt="player photo">
        </div>
        <div class="information">
          <div class="name">
            ${item.name}
          </div>
          <div class="country">
            ${item.country}
          </div>
          <div class="fc">
            ${item.fc}
          </div>
          <div class="tip">
              ${item.tip}
          </div>
          <div class="stats">
            <div class="attack">
              <span>${item.attack}</span>
            </div>
            <div class="defense">
              <span>${item.defense}</span>
            </div>
          </div>
        </div>
      </div>
      `;
        })
    },

    sendCardsFromField() {
        const cards = [];

        line4 = this.myAttackLine.querySelectorAll(".card");
        line3 = this.myMiddleLine.querySelectorAll(".card");
        line2 = this.myDefenseLine.querySelectorAll(".card");
        line1 = this.myGoalkeeperLine.querySelectorAll(".card");

        line4.forEach(item => {
            let card;
            if (item.classList.contains("player")) {
                card = this.generatePlayerobj(item);
            } else {
                card = this.generateFunctionalityObj(item);
            }
            card.pos = 4;
            cards.push(card);
        });

        line3.forEach(item => {
            let card;
            if (item.classList.contains("player")) {
                card = this.generatePlayerobj(item);
            } else {
                card = this.generateFunctionalityObj(item);
            }
            card.pos = 3;
            cards.push(card);
        });

        line2.forEach(item => {
            let card;
            if (item.classList.contains("player")) {
                card = this.generatePlayerobj(item);
            } else {
                card = this.generateFunctionalityObj(item);
            }
            card.pos = 2;
            cards.push(card);
        });

        line1.forEach(item => {
            let card;
            if (item.classList.contains("player")) {
                card = this.generatePlayerobj(item);
            } else {
                card = this.generateFunctionalityObj(item);
            }
            card.pos = 1;
            cards.push(card);
        });

        //console.log("players");

        //console.log(cards);

        return cards;
    },

    generatePlayerobj(div, pos) {
        const c = new Card();

        c.image = div.querySelector(".photo img").src;
        c.name = div.querySelector(".name").innerHTML;
        c.attack = Number(div.querySelector(".attack span").innerHTML);
        c.defense = Number(div.querySelector(".defense span").innerHTML);
        c.fc = div.querySelector(".fc").innerHTML;
        c.country = div.querySelector(".country").innerHTML;
        c.tip = Number(div.querySelector(".tip").innerHTML);
        c.pos = pos;

        return c;
    },

    generateFunctionalityObj(div, pos) {
        const p = new Power();

        p.image = div.querySelector(".photo img").src;
        p.name = div.querySelector(".name").innerHTML;
        p.description = div.querySelector(".description").innerHTML;
        p.tip = 0;
        p.pos = pos;

        return p;
    },

    generateLeaderObj(div) {
        const c = new Coach();

        c.image = div.querySelector(".photo img").src;
        c.name = div.querySelector(".name").innerHTML;
        c.description = div.querySelector(".description").innerHTML;
        this.active = 0;
        this.passive = 0;
        this.descpassive = "";
        this.descactive = "";
    },

    generatePlayerCardFromObj(obj) {
        const player = createElement("div");
        player.classList.add("card", "player");
        player.innerHTML = `
        <div class="photo">
          <img src=${item.image} alt="player photo">
        </div>
        <div class="information">
          <div class="name">
            ${obj.name}
          </div>
          <div class="country">
            ${obj.country}
          </div>
          <div class="fc">
            ${obj.fc}
          </div>
          <div class="stats">
            <div class="attack">
              <span>${obj.attack}</span>
            </div>
            <div class="defense">
              <span>${obj.defense}</span>
            </div>
          </div>
        </div>
        `;
        player.onclick = () => this.showClickedCard(player);

        return player;
    },

    generateFunctionalityCardFromObj(obj) {
        const func = createElement("div");
        func.classList.add("card", "functionality");
        func.innerHTML = `
        <div class="photo">
          <img src=${obj.image} alt="functionality photo">
        </div>
        <div class="information">
          <div class="name">
            ${obj.name}
          </div>
          <div class="description">
            ${obj.description}
          </div>
        </div>
        `;
        func.onclick = () => this.showClickedCard(func);

        return func;
    },

    putOnFieldByPos(attDiv, midDiv, defDiv, gkDiv, pos, cardDiv) {
        if (pos === 1) {
            gkDiv.appendChild(cardDiv);
        } else if (pos === 2) {
            defDiv.appendChild(cardDiv);
        } else if (pos === 3) {
            midDiv.appendChild(cardDiv);
        } else {
            attDiv.appendChild(cardDiv);
        }
    },

    generateCardsOnFieldFromBlob(info, currPlayerId) {
        info.forEach(player => {
            if (player.id === currPlayerId) {
                const { myAttackLine, myMiddleLine, myDefenseLine, myGoalkeeperLine } = this;

                myAttCardsPlace = myAttackLine.querySelector(".cards-place");
                myAttScore = myAttackLine.querySelector(".line-score");

                myMidCardsPlace = myMiddleLine.querySelector(".cards-place");
                myMidScore = myMiddleLine.querySelector(".line-score");

                myDefCardsPlace = myDefenseLine.querySelector(".cards-place");
                myDefScore = myDefenseLine.querySelector(".line-score");

                myGkCardsPlace = myGoalkeeperLine.querySelector(".cards-place");
                myGkScore = myGoalkeeperLine.querySelector(".line-score");

                myAttCardsPlace.innerHTML = "";
                myMidCardsPlace.innerHTML = "";
                myDefCardsPlace.innerHTML = "";
                myGkCardsPlace.innerHTML = "";

                if (player.cards.length > 0) {
                    player.cards.forEach(card => {
                        let cardDiv;
                        if (!card.fc && !card.country) {
                            cardDiv = this.generateFunctionalityCardFromObj(card);
                        } else {
                            cardDiv = this.generatePlayerCardFromObj(card);
                        }

                        putOnFieldByPos(myAttCardsPlace, myMidCardsPlace, myDefCardsPlace, myGkCardsPlace, card.pos, cardDiv);
                    });
                }

                const { enemyAttackLine, enemyMiddleLine, enemyDefenseLine, enemyGoalkeeperLine } = this;
                enemyAttCardsPlace = enemyAttackLine.querySelector(".cards-place");
                enemyAttScore = enemyAttackLine.querySelector(".line-score");

                enemyMidCardsPlace = enemyMiddleLine.querySelector(".cards-place");
                enemyMidScore = enemyMiddleLine.querySelector(".line-score");

                enemyDefCardsPlace = enemyDefenseLine.querySelector(".cards-place");
                enemyDefScore = enemyDefenseLine.querySelector(".line-score");

                enemyGkCardsPlace = enemyGoalkeeperLine.querySelector(".cards-place");
                enemyGkScore = enemyGoalkeeperLine.querySelector(".line-score");

                enemyAttCardsPlace.innerHTML = "";
                enemyMidCardsPlace.innerHTML = "";
                enemyDefCardsPlace.innerHTML = "";
                enemyGkCardsPlace.innerHTML = "";

                if (player.opCards.length > 0) {
                    player.opCards.forEach(card => {
                        let cardDiv;
                        if (!card.fc && !card.country) {
                            cardDiv = this.generateFunctionalityCardFromObj(card);
                        } else {
                            cardDiv = this.generatePlayerCardFromObj(card);
                        }

                        putOnFieldByPos(enemyAttCardsPlace, enemyMidCardsPlace, enemyDefCardsPlace, enemyGkCardsPlace, card.pos, cardDiv);
                    });
                }
            }
        });
    },

    //TODO implement pass button logic
    pressPass(player) {
        player.pass = true;
    }
}
var player;
var players = [];
window.onload = function () {
    player = new Player();
    //Card randomize section
    let cards = [];
    for (let i = 0; i < 20; i++) {
        cards.push(date.carte[Math.floor(Math.random() * date.carte.length)]);
    }
    receivedPlayers = cards;


    game.init();
    game.passBtn.onclick = () => game.pressPass(player);

    //Connection section
    connection = new WebSocketManager.Connection("ws://localhost:5000/server");

    connection.connectionMethods.onConnected = () => {
        player.id = connection.connectionId;
        connection.invoke("ConnectedPlayer", connection.connectionId, JSON.stringify(player));
    }

    connection.connectionMethods.onDisconnected = () => {
        connection.invoke("DisconnectedPlayer", connection.connectionId, "");
    }

    connection.clientMethods["pingPlayers"] = (serverPlayers) => {
        players = JSON.parse(serverPlayers);
        console.log("received info:");
        console.log(players);
        game.generateCardsOnFieldFromBlob(players, player.id);

    };

    connection.start();
   
    $(window).on("unload", function (e) {
        connection.invoke("DisconnectedPlayer", connection.connectionId, "");
    });


    //TODO: create update function that notifies the server of the client changes
    // this function gets called every .5 seconds
    setInterval(update, 500);
}

//TODO change this function to permit other player updates
// ConnectionId -> otherPlayer.id; player -> otherPlayer
function update() {
    player.cards = game.sendCardsFromField();
    //if (connection.socket.readyState == 1) {
    //    connection.invoke("Update", connection.connectionId, JSON.stringify(player));
    //}
    players.forEach(p => {
        if (p.id == player.id) {
            p.cards = player.cards;
            p.coach = player.coach;
           // p.turn = player.turn;
            p.pass = player.pass;
            p.opponentPass = player.opponentPass;
            let other = players.find(p => p.id !== player.id);
            p.opCards = (other)?other.cards : [];
            //TODO and other update stuff
            if (connection.socket.readyState == 1) {
                connection.invoke("Update", p.id, JSON.stringify(p));
            }
        }
        
    })
}

function Player() {
    this.id = "";
    this.test = 0;
    this.cards = [];
    this.opCards = [];
    this.coach = null;
    this.turn = false;
    this.pass = false;
    this.opponentPass = false;

}
function Card() {
    this.image = "";
    this.name = "";
    this.attack = 0;
    this.defense = 0;
    this.fc = "";
    this.country = "";
    this.tip = 0;
    this.pos = 0;
    this.description = "";

}
function Power() {
    this.image = "";
    this.name = "";
    this.description = "";
    this.tip = 0;
    this.pos = 0;
}
function Coach() {
    this.image = "";
    this.name = "";
    this.description = "";
    this.active = 0;
    this.passive = 0;
    this.descpassive = "";
    this.descactive = "";
}
function keyPush(evt) {
    switch (evt.keyCode) {
        case 37:
            snake.xvel = -1; snake.yvel = 0;
            break;
        case 38:
            snake.xvel = 0; snake.yvel = -1;
            break;
        case 39:
            snake.xvel = 1; snake.yvel = 0;
            break;
        case 40:
            snake.xvel = 0; snake.yvel = 1;
            break;
    }
}

function applyPower(players, power) {
    // EXEMPLE
    //Pentru playerul care nu suntem noi se lucreaza cu players.forEach
    if (power.tip === -2) {
        players.forEach(
            p => {
                if (p.id !== connection.connectionId) {
                    p.cards.forEach(c => {
                        if (c.pos === 4) {
                            c.attack -= 3;
                        }
                    });
                }
            });
    }
    //Pentru playerul curent se lucreaza cu player
    if (power.tip === -1) {
        player.cards.forEach(c => {
            if (c.pos === 4) {
                c.attack += 3;
            }
        });
    }

    // TODO: argumente pentru power cards?

    // 0 - BUFF TOTI JUCATORII DE PE TEREN
    if (power.tip === 0) {
        player.cards.forEach(c => {
            c.attack += 1;
            c.defense += 1;
        });
    }

    // 1 - BUFF TOTI JUCATORII DE PE O LINIE
    if (power.tip === 1) {
        player.cards.forEach(c => {
            if (c.pos === 4) {
                c.attack += 3;
            }
        });
    } 
    

    // 2 - BUFF TOTI JUCATORII DE PE TEREN APARTINAND ACELEASI TARI
    if (power.tip === 2) {
        player.cards.forEach(c => {
            if (c.country === "England") {
                c.attack += 2;
                c.defense += 2;
            }
        });
    }

    // 3 - BUFF TOTI JUCATORII DE PE TEREN APARTINAND ACELEASI ECHIPE
    if (power.tip === 3) {
        player.cards.forEach(c => {
            if (c.fc === "Liverpool") {
                c.attack += 3;
                c.defense += 3;
            }
        });
    }

    // 4 - BUFF TOTI JUCATORII DE PE TEREN CE INDEPLINESC O ANUMITA CONDITIE
    if (power.tip === 4) {
        player.cards.forEach(c => {
            if (c.attack <= 4) {
                c.attack *= 2;
            }
        });
    }

    // 5 - BUFF TOTI JUCATORII CE JOACA UN ANUMIT ROL(ex: portar)
    if (power.tip === 5) {
        player.cards.forEach(c => {
            if (c.tip == 0) {
                c.defense *= 3;
                c.attack += 2;
            }
        });
    }

    // 6 - DEBUFF TOTI JUCATORII ADVERSI DE PE O ANUMITA LINIE
    if (power.tip === 6) {
        players.forEach(
            p => {
                if (p.id !== connection.connectionId) {
                    p.cards.forEach(c => {
                        if (c.pos === 4) {
                            c.attack -= 2;
                            c.defense -= 2;
                        }
                    });
                }
            });
    }

    // 7 - DEBUFF TOTI JUCATORII ADVERSI DE PE TEREN
    if (power.tip === 7) {
        players.forEach(
            p => {
                if (p.id !== connection.connectionId) {
                    p.cards.forEach(c => {
                        c.attack -= 2;
                        c.defense -= 2;
                    });
                }
            });
    }

    // 8 - ELIMINA TOTI JUCATORII ADVERSI CE INDEPLINESC O ANUMITA CONDITIE
    if (power.tip === 8) {
        players.forEach(
            p => {
                if (p.id !== connection.connectionId) {
                    p.cards.forEach(c => {
                        if (c.defense <= 4) {
                            c.attack -= 2;
                            c.defense = 1;
                        }
                    });
                }
            });
    }
}
var date = {
    "carte": [
        {
            "image": "https://placehold.it/200x200",
            "name": "adrian mutu",
            "attack": "5",
            "defense": "16",
            "fc": "rapid",
            "country": "romania",
            "tip": "0",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Jordan Pickford",
            "attack": "2",
            "defense": "8",
            "fc": "Everton",
            "country": "England",
            "tip": "0",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Kyle Walker",
            "attack": "4",
            "defense": "7",
            "fc": "Manchester City",
            "country": "England",
            "tip": "1",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Kieran Trippier",
            "attack": "2",
            "defense": "8",
            "fc": "Tottenham Hotspur",
            "country": "England",
            "tip": "1",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "John Stones",
            "attack": "2",
            "defense": "5",
            "fc": "Manchester City",
            "country": "England",
            "tip": "1",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Eric Dier",
            "attack": "3",
            "defense": "5",
            "fc": "Tottenham Hotspur",
            "country": "England",
            "tip": "2",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Ross Barkley",
            "attack": "3",
            "defense": "6",
            "fc": "Chelsea",
            "country": "England",
            "tip": "2",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Jordan Henderson",
            "attack": "4",
            "defense": "5",
            "fc": "Liverpool",
            "country": "England",
            "tip": "2",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Harry Winks",
            "attack": "4",
            "defense": "4",
            "fc": "Tottenham Hotspur",
            "country": "England",
            "tip": "2",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Raheem Sterling",
            "attack": "8",
            "defense": "2",
            "fc": "Manchester City",
            "country": "England",
            "tip": "3",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Harry Kane",
            "attack": "8",
            "defense": "4",
            "fc": "Tottenham Hotspur",
            "country": "England",
            "tip": "3",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Marcus Rashford",
            "attack": "6",
            "defense": "2",
            "fc": "Manchester United",
            "country": "England",
            "tip": "3",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Hugo Lloris",
            "attack": "3",
            "defense": "8",
            "fc": "Tottenham Hotspur",
            "country": "France",
            "tip": "0",
            "pos": "0"
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Benjamin Pavard",
            "attack": "2",
            "defense": "6",
            "fc": "VfB Stuttgart",
            "country": "France",
            "tip": "1",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Presnel Kimpembe",
            "attack": "1",
            "defense": "7",
            "fc": "Paris Saint-Germain",
            "country": "France",
            "tip": "1",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Mamadou Sakho",
            "attack": "4",
            "defense": "5",
            "fc": "Crystal Palace",
            "country": "France",
            "tip": "1",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Lucas Digne",
            "attack": "3",
            "defense": "5",
            "fc": "Everton",
            "country": "France",
            "tip": "1",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Lucas Hernández",
            "attack": "2",
            "defense": "6",
            "fc": "Atlético Madrid",
            "country": "France",
            "tip": "1",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "N'Golo Kanté",
            "attack": "4",
            "defense": "5",
            "fc": "Chelsea",
            "country": "France",
            "tip": "2",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Blaise Matuidi",
            "attack": "5",
            "defense": "6",
            "fc": "Juventus",
            "country": "France",
            "tip": "2",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Tanguy Ndombele",
            "attack": "5",
            "defense": "3",
            "fc": "Lyon",
            "country": "France",
            "tip": "2",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Antoine Griezmann",
            "attack": "7",
            "defense": "1",
            "fc": "Atlético Madrid",
            "country": "France",
            "tip": "3",
            "pos": "0",
            "": {}
        },
        {
            "image": "https://placehold.it/200x200",
            "name": "Thomas Lemar",
            "attack": "6",
            "defense": "4",
            "fc": "Atlético Madrid",
            "country": "France",
            "tip": "3",
            "pos": "0"
        }
    ],
    "power": [
        {
            "image": "https://placehold.it/200x200",
            "name": "cox",
            "description": "50$/gr",
            "tip": "0",
            "pos": "0"
        }
    ],
    "coach": [
        {
            "image": "https://placehold.it/200x200",
            "name": "hagi",
            "passive": "0",
            "descpassive": "ai n-ai mingea dai la poarta",
            "active": "0",
            "description": "Lorem ipsum dolor sit amet, consectetur adipisicing elit. In soluta repudiandae odio, provident quod hic harum delectus, sunt voluptatem architecto atque, expedita labore alias sequi.",
            "descactive": "autogol"
        }
    ]
};